
{% extends 'base.html' %}
{% block content %}
<h1>Admin Dashboard</h1>

<!-- ===== KPI cards ===== -->
<div class="kpi-row">
  <div class="kpi-card">
    <h3>{{ total_uploads }}</h3>
    <p>Total Uploads</p>
  </div>
  <div class="kpi-card">
    <h3>{{ total_views }}</h3>
    <p>Total Views</p>
  </div>
</div>

<h2 style="margin-top:25px;">Top¬†10 Most‚ÄëViewed Media</h2>
<canvas id="viewsChart" class="chart-canvas"></canvas>

<h3>Views by Target Condition</h3>
<canvas id="conditionChart" class="chart-canvas"></canvas>

<!-- ===== Uploads table ===== -->
<h2 style="margin-top:35px;">All Uploads</h2>
<div class="responsive-table">
  <table class="clean-table">
    <thead>
      <tr>
        <th>Title</th>
        <th>Condition</th>
        <th>Domain</th>
        <th class="hide-sm">Views</th>
        <th class="hide-sm">Uploader</th>
        <th class="hide-sm">Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for item in media %}
      <tr>
        <td data-label="Title">{{ item.title }}</td>
        <td data-label="Condition">{{ item.target_condition }}</td>
        <td data-label="Domain">{{ item.otpf_domain }}</td>
        <td data-label="Views" class="hide-sm">{{ item.view_count }}</td>
        <td data-label="Uploader" class="hide-sm">{{ item.uploader.username }}</td>
        <td data-label="Date" class="hide-sm">{{ item.upload_time.strftime('%Y-%m-%d') }}</td>
        <td data-label="Actions">
          <a href="{{ url_for('watch', media_id=item.id) }}">üëÅ</a>
          <a href="{{ url_for('edit_media', media_id=item.id) }}">‚úèÔ∏è</a>
          <form action="{{ url_for('delete_media', media_id=item.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Delete this media?');">
            <button type="submit">üóë</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ===== Chart.js script ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('viewsChart').getContext('2d');
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: {{ chart_labels|tojson }},
    datasets: [{
      label: 'Views',
      data: {{ chart_views|tojson }},
    }]
  },
  options: {
    plugins: { legend: { display: false } },
    scales: { y: { beginAtZero: true } }
  }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx2 = document.getElementById('conditionChart');
  new Chart(ctx2, {
    type: 'pie',
    data: {
      labels: {{ condition_labels|tojson }},
      datasets: [{
        label: 'Views by Condition',
        data: {{ condition_data|tojson }},
        backgroundColor: [
          '#8e44ad', '#f39c12', '#3498db', '#e74c3c', '#2ecc71', '#1abc9c',
          '#9b59b6', '#34495e', '#16a085', '#d35400'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'right' }
      }
    }
  });
</script>

{% endblock %}


{#
{% extends 'base.html' %}
{% block content %}
<h1>Admin Dashboard</h1>
<table>
    <tr>
        <th>Title</th>
        <th>Condition</th>
        <th>Domain</th>
        <th>Views</th>
        <th>Uploader</th>
        <th>Uploaded On</th>
        <th>Actions</th>
    </tr>
    {% for item in media %}
    <tr>
        <td>{{ item.title }}</td>
        <td>{{ item.target_condition }}</td>
        <td>{{ item.otpf_domain }}</td>
        <td>{{ item.view_count }}</td>
        <td>{{ item.uploader.username }}</td>
        <td>{{ item.upload_time.strftime('%Y-%m-%d') }}</td>
        <td>
            <a href="{{ url_for('watch', media_id=item.id) }}">View</a> |
            <a href="{{ url_for('edit_media', media_id=item.id) }}">Edit</a> |
            <form action="{{ url_for('delete_media', media_id=item.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this media?');">
                <button type="submit" style="color:red; border:none; background:none;">Delete</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
#}